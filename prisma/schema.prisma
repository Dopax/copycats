generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model Ad {
  id              String       @id @default(uuid())
  postId          String       @unique // The Facebook Post ID
  brand           String?
  description     String?
  headline        String?
  adLink          String?      // Facebook Ad Link
  facebookLink    String?      // Facebook Post Permalink
  videoUrl        String?      // URL to the video/image file
  thumbnailUrl    String?
  firstSeen       DateTime     @default(now())
  lastSeen        DateTime     @default(now())
  publishDate     DateTime?
  
  archived        Boolean      @default(false)
  priority        Int?         // 1=High, 2=Medium, 3=Low, null=No priority
  notes           String?
  
  snapshots       AdSnapshot[]
  tags            Tag[]
  
  createdAt       DateTime     @default(now())
  updatedAt       DateTime     @updatedAt

  formatId        String?
  format          AdFormat?    @relation(fields: [formatId], references: [id])
  
  hookId          String?
  hook            AdHook?      @relation(fields: [hookId], references: [id])

  themeId         String?
  theme           AdTheme?     @relation(fields: [themeId], references: [id])

  angleId         String?
  angle           AdAngle?     @relation(fields: [angleId], references: [id])

  awarenessLevelId String?
  awarenessLevel   AdAwarenessLevel? @relation(fields: [awarenessLevelId], references: [id])

  referencedInBatches AdBatch[]
}

model AdFormat {
  id    String @id @default(uuid())
  name  String @unique
  ads   Ad[]
  batches AdBatch[]
}

model AdHook {
  id           String   @id @default(uuid())
  name         String   @unique
  type         String?  // FLOATING_ELEMENTS, FB_COMMENT, TIKTOK_COMMENT, TEXT, VFX, FRAME_SELECTION, AUDIO
  content      String?  // Text content for comment/text hooks
  videoUrl     String?  // Uploaded or linked video file
  thumbnailUrl String?
  
  ads          Ad[]
  batchItems   BatchItem[]
  
  createdAt    DateTime @default(now())
  updatedAt    DateTime? @updatedAt
}

model AdTheme {
  id       String @id @default(uuid())
  name     String @unique
  ads      Ad[]
  concepts CreativeConcept[]
}

model AdAngle {
  id       String @id @default(uuid())
  name     String @unique
  ads      Ad[]
  concepts CreativeConcept[]
}

model AdDemographic {
  id       String @id @default(uuid())
  name     String @unique
  concepts CreativeConcept[]
}


model AdAwarenessLevel {
  id       String @id @default(uuid())
  name     String @unique
  ads      Ad[]
  batches  AdBatch[]
}

model CreativeConcept {
  id            String @id @default(uuid())
  name          String
  
  angleId       String
  angle         AdAngle @relation(fields: [angleId], references: [id])
  
  themeId       String
  theme         AdTheme @relation(fields: [themeId], references: [id])
  
  demographicId String
  demographic   AdDemographic @relation(fields: [demographicId], references: [id])
  
  batches       AdBatch[]

  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
}

model AdSnapshot {
  id        String   @id @default(uuid())
  adId      String
  ad        Ad       @relation(fields: [adId], references: [id], onDelete: Cascade)
  
  likes     Int      @default(0)
  shares    Int      @default(0)
  comments  Int      @default(0)
  
  capturedAt DateTime @default(now())

  importBatchId String?
  importBatch   ImportBatch? @relation(fields: [importBatchId], references: [id])
}

model Tag {
  id    String @id @default(uuid())
  name  String @unique
  ads   Ad[]
}

model AdBatch {
  id          Int      @id @default(autoincrement())
  name        String
  status      String   @default("IDEATION") // IDEATION, BRIEFING, EDITING, REVIEW, LAUNCHING, COMPLETED, ARCHIVED
  batchType   String   // COPYCAT, NET_NEW, ITERATION
  priority    String?  // HIGH, MEDIUM, LOW

  conceptId   String
  concept     CreativeConcept @relation(fields: [conceptId], references: [id])

  formatId    String?
  format      AdFormat? @relation(fields: [formatId], references: [id])

  awarenessLevelId String?
  awarenessLevel   AdAwarenessLevel? @relation(fields: [awarenessLevelId], references: [id])

  assignee    String?   // Editor Name
  brief       String?   // Markdown or text

  // If Copycat or Iteration, link to an existing Ad
  referenceAdId String?
  referenceAd   Ad?     @relation(fields: [referenceAdId], references: [id])

  items       BatchItem[]

  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model BatchItem {
  id        String   @id @default(uuid())
  batchId   Int
  batch     AdBatch  @relation(fields: [batchId], references: [id], onDelete: Cascade)

  hookId    String?
  hook      AdHook?  @relation(fields: [hookId], references: [id])

  notes     String?
  script    String?
  status    String   @default("PENDING") // PENDING, DONE
}

model ImportBatch {
  id        String   @id @default(cuid())
  name      String
  createdAt DateTime @default(now())
  snapshots AdSnapshot[]
}
